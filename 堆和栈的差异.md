# <font color=#0099ff> **堆栈区分** </font> 

> `@think3r` 2019-01-18 22:05:02

## <font color=#009A000> 0x00 概述 </font> 

> 1. [什么是堆？什么是栈？他们之间有什么区别和联系？](https://www.zhihu.com/question/19729973/answer/13037929)   
> 2. [堆和栈的概念和区别-JAVA](https://blog.csdn.net/pt666/article/details/70876410)
  
- 这里的堆, 应该指的是 heap 而非数据结构中的堆。
- 栈区（stack）— 由编译器自动分配释放 ，存放函数的参数值，局部变量的值等。其操作方式类似于数据结构中的栈。
- 堆区（heap） — 一般由程序员分配释放， 若程序员不释放，程序结束时可能由OS回收 。

## <font color=#009A000> 0x01 区别和联系 </font> 

1. 申请方式  
    - 堆是由程序员自己申请并指明大小，在 c 中 malloc 函数 如 `p1 = (char *)malloc(10)` ;
    - 栈由系统自动分配，如声明在函数中一个局部变量 `int b` ; 系统自动在栈中为 b 开辟空间
2. 2.申请后系统的响应    
    - 栈：只要栈的剩余空间大于所申请空间，系统将为程序提供内存，否则将报异常提示栈溢出。    
    - 堆：首先应该知道操作系统有一个记录空闲内存地址的链表，当系统收到程序的申请时，会 遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲结点链表中删除，并将该结点的空间分配给程序，另外，对于大多数系统，会在这块内 存空间中的首地址处记录本次分配的大小，这样，代码中的 `delete` 语句才能正确的释放本内存空间。另外，由于找到的堆结点的大小不一定正好等于申请的大 小，系统会自动的将多余的那部分重新放入空闲链表中。
3. 申请大小的限制    
    - 栈：在 Windows 下,栈是向低地址扩展的数据结 构，是一块连续的内存的区域。这句话的意思是栈顶的地址和栈的最大容量是系统预先规定好的，在 WINDOWS 下，栈的大小是 2M（也有的说是 1M，总之是 一个编译时就确定的常数），如果申请的空间超过栈的剩余空间时，将提示 overflow。因此，能从栈获得的空间较小。   
    - 堆：堆是向高地址扩展的数据结构，是不连续的内存区域。这是由于系统是用链表来存储的空闲内存地址的，自然是不连续的，而链表的遍历方向是由低地址向高地址。堆的大小受限于计算机系统中有效的虚拟内存。由此可见，堆获得的空间比较灵活，也比较大。
4. 申请效率的比较：
    -  栈由系统自动分配，速度较快。但程序员是无法控制的。
    -  堆是由 new 分配的内存，一般速度比较慢，而且容易产生内存碎片,不过用起来最方便.

## <font color=#009A000> 0x02 new </font> 

- 语法: `new 数据类型(初始化参数列表);`
    - 关于 new 后加 () 与不加 () 的区别：
        - 在用 new 建立一个类的对象时，若存在用户定义的默认构造函数，则 new T 和 new T() 两写法效果相同，都会调用此默认构造函数；若未定义，new T 会调用系统默认构造函数，new T() 除了调用系统默认构造函数，还会给基本数据类型和指针类型的成员用 0 赋值，且该过程是递归的。即若该对象的某个成员对象未定义默认构造函数，那么该成员对象的基本数据类型和指针类型的成员同样会被以0赋值。
    - **故用 new 的时候请加上 ()**。
